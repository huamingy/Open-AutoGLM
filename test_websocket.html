<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>WebSocketæµ‹è¯•</title>
</head>
<body>
    <h2>WebSocketè¿æ¥æµ‹è¯•</h2>
    <div>
        <button onclick="testConnection()">æµ‹è¯•è¿æ¥</button>
        <button onclick="testTerminate()">æµ‹è¯•ç»ˆæ­¢</button>
    </div>
    <div id="output"></div>

    <script>
        let ws;

        function addOutput(text) {
            document.getElementById('output').innerHTML += text + '<br>';
        }

        function testConnection() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.close();
                addOutput('è¿æ¥å·²å…³é—­');
                return;
            }

            ws = new WebSocket('ws://localhost:8002/ws');

            ws.onopen = () => {
                addOutput('âœ… WebSocketè¿æ¥æˆåŠŸ');
                // å‘é€æµ‹è¯•å‘½ä»¤
                ws.send(JSON.stringify({ text: 'echo hello' }));
            };

            ws.onmessage = (event) => {
                addOutput('ğŸ“¥ æ”¶åˆ°æ¶ˆæ¯: ' + event.data);
            };

            ws.onclose = () => {
                addOutput('ğŸ”Œ è¿æ¥å·²å…³é—­');
            };

            ws.onerror = (error) => {
                addOutput('âŒ è¿æ¥é”™è¯¯: ' + error);
            };
        }

        function testTerminate() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                addOutput('å‘é€ç»ˆæ­¢å‘½ä»¤...');
                ws.send(JSON.stringify({ action: 'terminate' }));
            } else {
                addOutput('âŒ WebSocketæœªè¿æ¥');
            }
        }
    </script>
</body>
</html>
